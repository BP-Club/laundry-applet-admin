<?php /*a:3:{s:77:"/www/wwwroot/test.cloudskys.cn/ThinkAdmin/app/data/view/shop/order/index.html";i:1670552399;s:82:"/www/wwwroot/test.cloudskys.cn/ThinkAdmin/app/data/view/../../admin/view/main.html";i:1670552399;s:84:"/www/wwwroot/test.cloudskys.cn/ThinkAdmin/app/data/view/shop/order/index_search.html";i:1677467153;}*/ ?>
<div class="layui-card"><?php if(!(empty($title) || (($title instanceof \think\Collection || $title instanceof \think\Paginator ) && $title->isEmpty()))): ?><div class="layui-card-header"><span class="layui-icon font-s10 color-desc margin-right-5">&#xe65b;</span><?php echo htmlentities((isset($title) && ($title !== '')?$title:''),ENT_QUOTES); ?><div class="pull-right"><!--<?php if(auth("clean")): ?>--><button class='layui-btn layui-btn-sm layui-btn-primary' data-queue='<?php echo url("clean"); ?>'>定时清理订单</button><!--<?php endif; ?>--></div></div><?php endif; ?><div class="layui-card-line"></div><div class="layui-card-body"><div class="layui-card-html"><div class="layui-tab layui-tab-card"><ul class="layui-tab-title notselect"><?php $types = ['ta' => '全部订单', 't2' => '等待支付', 't3' => '等待审核', 't4' => '等待发货', 't5' => '等待收货', 't6' => '已经完成', 't0' => '已经取消']; foreach($types as $k=>$v): if(isset($type) and 't'.$type == $k): ?><li class="layui-this" data-open="<?php echo url('index'); ?>?type=<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?><sup class="layui-badge border-radius"><?php echo isset($total[$k]) ? htmlentities($total[$k],ENT_QUOTES) : 0; ?></sup></li><?php else: ?><li data-open="<?php echo url('index'); ?>?type=<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?><sup class="layui-badge border-radius"><?php echo isset($total[$k]) ? htmlentities($total[$k],ENT_QUOTES) : 0; ?></sup></li><?php endif; ?><?php endforeach; ?></ul><div class="layui-tab-content"><form action="<?php echo sysuri(); ?>" autocomplete="off" class="layui-form layui-form-pane form-search" method="get" onsubmit="return false"><div class="layui-form-item layui-inline"><label class="layui-form-label">订单用户</label><label class="layui-input-inline"><input class="layui-input" name="user_keys" placeholder="请输入手机或昵称" value="<?php echo htmlentities((isset($get['user_keys']) && ($get['user_keys'] !== '')?$get['user_keys']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">推荐用户</label><label class="layui-input-inline"><input class="layui-input" name="from_keys" placeholder="请输入手机或昵称" value="<?php echo htmlentities((isset($get['from_keys']) && ($get['from_keys'] !== '')?$get['from_keys']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">订单单号</label><label class="layui-input-inline"><input class="layui-input" name="order_no" placeholder="请输入订单单号" value="<?php echo htmlentities((isset($get['order_no']) && ($get['order_no'] !== '')?$get['order_no']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">发货单号</label><label class="layui-input-inline"><input class="layui-input" name="truck_send_number" placeholder="请输入发货单号" value="<?php echo htmlentities((isset($get['truck_send_number']) && ($get['truck_send_number'] !== '')?$get['truck_send_number']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">订单状态</label><label class="layui-input-inline"><select class="layui-select" name="status"><option value=''>- 全部订单 -</option><?php foreach(['1'=>'预购订单','2'=>'等待支付','3'=>'等待审核','4'=>'等待发货','5'=>'已经发货','6'=>'已经完成','0'=>'已经取消'] as $k=>$v): if(input('status') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">付款状态</label><label class="layui-input-inline"><select class="layui-select" name="payment_status"><option value=''>-- 全部 --</option><?php foreach(['0'=>'等待支付','1'=>'已经支付'] as $k=>$v): if(input('payment_status') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">支付方式</label><label class="layui-input-inline"><select class="layui-select" name="payment_type"><option value=''>-- 全部 --</option><?php foreach($payments as $k=>$v): if(input('payment_type') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v['name'],ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v['name'],ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">下单时间</label><label class="layui-input-inline"><input class="layui-input" data-date-range name="create_at" placeholder="请选择下单时间" value="<?php echo htmlentities((isset($get['create_at']) && ($get['create_at'] !== '')?$get['create_at']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">支付时间</label><label class="layui-input-inline"><input class="layui-input" data-date-range name="payment_datetime" placeholder="请选择支付时间" value="<?php echo htmlentities((isset($get['payment_datetime']) && ($get['payment_datetime'] !== '')?$get['payment_datetime']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">收货姓名</label><label class="layui-input-inline"><input class="layui-input" name="truck_address_name" placeholder="请输入收货姓名" value="<?php echo htmlentities((isset($get['truck_address_name']) && ($get['truck_address_name'] !== '')?$get['truck_address_name']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">收货手机</label><label class="layui-input-inline"><input class="layui-input" name="truck_address_phone" placeholder="请输入收货手机" value="<?php echo htmlentities((isset($get['truck_address_phone']) && ($get['truck_address_phone'] !== '')?$get['truck_address_phone']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">收货地址</label><label class="layui-input-inline"><input class="layui-input" name="truck_address_content" placeholder="请输入收货省份" value="<?php echo htmlentities((isset($get['truck_address_content']) && ($get['truck_address_content'] !== '')?$get['truck_address_content']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><button class="layui-btn layui-btn-primary" type="submit"><i class="layui-icon">&#xe615;</i> 搜 索</button><button class="layui-btn layui-btn-primary" data-form-export="<?php echo url('index'); ?>?type=<?php echo htmlentities((isset($type) && ($type !== '')?$type:''),ENT_QUOTES); ?>" type="button"><i class="layui-icon layui-icon-export"></i> 导 出
        </button></div></form><script>
    require(['excel'], function (excel) {
        excel.bind(function (data) {
            var items = [];
            items.push(['订单号', '用户手机', '用户姓名', '订单类型', '支付单号', '支付方式', '支付状态', '支付金额', '支付时间']);
            data.forEach(function (order) {
                items.push([
                    order.order_no,
                    order.user.phone,
                    order.user.username || order.user.nickname || '',
                    order.truck_type ? '虚拟商品' : '实物商品',
                    order.payment_trade || '',
                    order.payment_name || order.payment_type || '',
                    order.payment_status ? '已支付' : '未支付',
                    order.payment_amount || '0.00',
                    order.payment_datetime || '',
                ]);
            });
            return items;
        }, '用户订单记录');
    });
</script><table class="layui-table margin-top-10" lay-skin="line"><?php if(!(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty()))): ?><thead><tr><th class='list-table-check-td think-checkbox'><label><input data-auto-none data-check-target='.list-check-box' type='checkbox'></label></th><th>用户信息</th><th>订单信息</th><th>发货信息</th><th>商品信息</th></tr></thead><?php endif; ?><tbody><?php foreach($list as $key=>$vo): ?><tr><td class='list-table-check-td think-checkbox'><label><input class="list-check-box" type='checkbox' value='<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'></label></td><td class="nowrap relative"><div><!--<?php if(!(empty($vo['from']) || (($vo['from'] instanceof \think\Collection || $vo['from'] instanceof \think\Paginator ) && $vo['from']->isEmpty()))): ?>--><div class="headimg" data-lazy-src="<?php echo htmlentities((isset($vo['from']['headimg']) && ($vo['from']['headimg'] !== '')?$vo['from']['headimg']:'/static/theme/img/headimg.png'),ENT_QUOTES); ?>" data-tips-image></div><div class="inline-block sub-strong-red"><div>推荐用户：<span class="color-text"><?php echo htmlentities((isset($vo['from']['nickname']) && ($vo['from']['nickname'] !== '')?$vo['from']['nickname']:'--'),ENT_QUOTES); ?></span><span class="margin-left-5">[ <b>VIP<?php echo htmlentities($vo['from']['vip_code'],ENT_QUOTES); ?></b> ] <b><?php echo htmlentities($vo['from']['vip_name'],ENT_QUOTES); ?></b></span></div><div>推荐手机：<span class="color-text"><?php echo htmlentities((isset($vo['from']['phone']) && ($vo['from']['phone'] !== '')?$vo['from']['phone']:'--'),ENT_QUOTES); ?></span></div></div><!--<?php else: ?>--><div class="color-desc padding-10">没有代理</div><!--<?php endif; ?>--></div><div><div class="headimg" data-lazy-src="<?php echo htmlentities((isset($vo['user']['headimg']) && ($vo['user']['headimg'] !== '')?$vo['user']['headimg']:'/static/theme/img/headimg.png'),ENT_QUOTES); ?>" data-tips-image></div><div class="inline-block sub-strong-red">
                            用户昵称：<span class="color-text"><?php echo htmlentities((isset($vo['user']['nickname']) && ($vo['user']['nickname'] !== '')?$vo['user']['nickname']:'--'),ENT_QUOTES); ?></span><span class="margin-left-5">[ <b>VIP<?php echo htmlentities($vo['user']['vip_code'],ENT_QUOTES); ?></b> ] <b><?php echo htmlentities($vo['user']['vip_name'],ENT_QUOTES); ?></b></span><br>
                            用户手机：<span class="color-text"><?php echo htmlentities((isset($vo['user']['phone']) && ($vo['user']['phone'] !== '')?$vo['user']['phone']:'--'),ENT_QUOTES); ?></span><br></div></div></td><td class='nowrap'><?php if($vo['status'] == '0'): ?><span class="layui-badge layui-badge-middle layui-bg-gray layui-border-cyan" data-tips-text="<?php echo htmlentities($vo['cancel_remark'],ENT_QUOTES); ?>">已经取消</span><?php endif; if($vo['status'] == '1'): ?><span class="layui-badge layui-badge-middle layui-bg-red">预购订单</span><?php endif; if($vo['status'] == '2'): ?><span class="layui-badge layui-badge-middle layui-bg-red">等待待付款</span><?php endif; if($vo['status'] == '3'): ?><span class="layui-badge layui-badge-middle layui-bg-orange">等待审核</span><?php endif; if($vo['status'] == '4'): ?><span class="layui-badge layui-badge-middle layui-bg-black">等待发货</span><?php endif; if($vo['status'] == '5'): ?><span class="layui-badge layui-badge-middle layui-bg-blue">已经发货</span><?php endif; if($vo['status'] == '6'): ?><span class="layui-badge layui-badge-middle layui-bg-green">已经完成</span><?php endif; ?><div class="inline-block text-middle"><div class="sub-strong-blue">
                            订单单号：<b><?php echo htmlentities((isset($vo['order_no']) && ($vo['order_no'] !== '')?$vo['order_no']:''),ENT_QUOTES); ?></b><!--<?php if($vo['status'] == '3'): ?>--><a class="margin-left-5 layui-badge layui-bg-blue" data-modal="<?php echo url('audit'); ?>?order_no=<?php echo htmlentities($vo['order_no'],ENT_QUOTES); ?>">凭证审核</a><!--<?php endif; ?>--></div><div class="sub-strong-blue">
                            订单总计：<b><?php echo htmlentities($vo['amount_total']+0,ENT_QUOTES); ?></b> 元
                            <span class="color-green"><?php if($vo['amount_express']>0): ?>(含运费 <?php echo htmlentities($vo['amount_express']+0,ENT_QUOTES); ?> 元<?php else: ?>(包邮<?php endif; ?>, 随减 <?php echo htmlentities($vo['amount_reduct']+0,ENT_QUOTES); ?> 元)</span>
                            已支付 <b><?php echo htmlentities($vo['payment_amount']+0,ENT_QUOTES); ?></b> 元
                        </div><div>下单时间：<span class="color-text"><?php echo htmlentities(format_datetime($vo['create_at']),ENT_QUOTES); ?></span></div><!--<?php if(!(empty($vo['payment_status']) || (($vo['payment_status'] instanceof \think\Collection || $vo['payment_status'] instanceof \think\Paginator ) && $vo['payment_status']->isEmpty()))): ?>--><div>
                            支付时间：<span class="color-text"><?php echo htmlentities(format_datetime($vo['payment_datetime']),ENT_QUOTES); ?></span><?php if(!(empty($vo['payment_name']) || (($vo['payment_name'] instanceof \think\Collection || $vo['payment_name'] instanceof \think\Paginator ) && $vo['payment_name']->isEmpty()))): ?><!--<?php if(!(empty($vo['payment_image']) || (($vo['payment_image'] instanceof \think\Collection || $vo['payment_image'] instanceof \think\Paginator ) && $vo['payment_image']->isEmpty()))): ?>--><b class="margin-left-5 color-blue" data-tips-image="<?php echo htmlentities($vo['payment_image'],ENT_QUOTES); ?>" data-tips-text="<?php echo htmlentities((isset($vo['payment_remark']) && ($vo['payment_remark'] !== '')?$vo['payment_remark']:''),ENT_QUOTES); ?>">(<?php echo htmlentities((isset($vo['payment_name']) && ($vo['payment_name'] !== '')?$vo['payment_name']:'-'),ENT_QUOTES); ?>)</b><!--<?php else: ?>--><b class="margin-left-5 color-blue">(<?php echo htmlentities((isset($vo['payment_name']) && ($vo['payment_name'] !== '')?$vo['payment_name']:'-'),ENT_QUOTES); ?>)</b><!--<?php endif; ?>--><?php endif; ?></div><!--<?php else: ?>-->
                        支付状态：<span class="color-desc">还未支付</span><!--<?php endif; ?>--></div></td><td class="nowrap"><?php if(empty($vo['truck_type']) || (($vo['truck_type'] instanceof \think\Collection || $vo['truck_type'] instanceof \think\Paginator ) && $vo['truck_type']->isEmpty())): ?>
                    无需发货
                    <?php else: ?><div>收货信息：<?php echo htmlentities((isset($vo['truck']['address_name']) && ($vo['truck']['address_name'] !== '')?$vo['truck']['address_name']:'--'),ENT_QUOTES); ?><span class="margin-left-5 color-blue"><?php echo htmlentities((isset($vo['truck']['address_phone']) && ($vo['truck']['address_phone'] !== '')?$vo['truck']['address_phone']:''),ENT_QUOTES); ?></span></div><div>收货地址：<?php echo htmlentities((isset($vo['truck']['address_province']) && ($vo['truck']['address_province'] !== '')?$vo['truck']['address_province']:'--'),ENT_QUOTES); ?><?php echo htmlentities((isset($vo['truck']['address_city']) && ($vo['truck']['address_city'] !== '')?$vo['truck']['address_city']:''),ENT_QUOTES); ?><?php echo htmlentities((isset($vo['truck']['address_area']) && ($vo['truck']['address_area'] !== '')?$vo['truck']['address_area']:''),ENT_QUOTES); ?><?php echo htmlentities((isset($vo['truck']['address_content']) && ($vo['truck']['address_content'] !== '')?$vo['truck']['address_content']:''),ENT_QUOTES); ?></div><div>发货状态：<!--<?php if(empty($vo['truck']['send_number'])): ?>--><span class="layui-badge layui-bg-black">未发货</span><!--<?php else: ?>--><span class="layui-badge layui-bg-blue"><?php echo htmlentities((isset($vo['truck']['company_name']) && ($vo['truck']['company_name'] !== '')?$vo['truck']['company_name']:'--'),ENT_QUOTES); ?></span><a class="layui-badge layui-bg-orange" data-modal="<?php echo url('shop.send/query'); ?>?code=<?php echo htmlentities((isset($vo['truck']['company_code']) && ($vo['truck']['company_code'] !== '')?$vo['truck']['company_code']:''),ENT_QUOTES); ?>&number=<?php echo htmlentities((isset($vo['truck']['send_number']) && ($vo['truck']['send_number'] !== '')?$vo['truck']['send_number']:''),ENT_QUOTES); ?>" data-title="快递查询"><?php echo htmlentities((isset($vo['truck']['send_number']) && ($vo['truck']['send_number'] !== '')?$vo['truck']['send_number']:'--'),ENT_QUOTES); ?></a><!--<?php endif; ?>--><!--<?php if(auth('shop.send/truck') and $vo['status'] == 3): ?>--><a class="margin-left-5" data-modal="<?php echo url('shop.send/truck'); ?>?order_no=<?php echo htmlentities($vo['order_no'],ENT_QUOTES); ?>" data-title="填写订单信息">填写发货</a><!--<?php elseif(auth('shop.send/truck') and $vo['status'] == 4): ?>--><a class="margin-left-5" data-modal="<?php echo url('shop.send/truck'); ?>?order_no=<?php echo htmlentities($vo['order_no'],ENT_QUOTES); ?>" data-title="修改发货信息">修改发货</a><!--<?php endif; ?>--><!--<?php if(auth('cancel') and in_array($vo['status'], [1,2,3])): ?>--><a class="margin-left-5" data-confirm="确认要取消订单吗？" data-load="<?php echo url('cancel'); ?>?order_no=<?php echo htmlentities($vo['order_no'],ENT_QUOTES); ?>">取消订单</a><!--<?php endif; ?>--></div><div>发货时间：<?php echo htmlentities((isset($vo['truck']['send_datetime']) && ($vo['truck']['send_datetime'] !== '')?$vo['truck']['send_datetime']:'--'),ENT_QUOTES); ?></div><?php endif; ?></td><td class="nowrap"><?php foreach($vo['items'] as $g): ?><div><?php if($g['vip_entry'] > 0 and $g['vip_upgrade'] > $g['vip_code']): ?>
                        [ <b class="color-red">VIP<?php echo htmlentities($g['vip_code'],ENT_QUOTES); ?></b><span class="layui-icon font-s10 color-blue">&#xe602;</span><b class="color-red">VIP<?php echo htmlentities($g['vip_upgrade'],ENT_QUOTES); ?></b> ]
                        <?php else: ?>
                        [ <b class="color-text">VIP<?php echo htmlentities($g['vip_code'],ENT_QUOTES); ?></b> ]
                        <?php endif; if($g['discount_rate'] < 100.00): ?><b class="color-blue">享<?php echo htmlentities($g['discount_rate']+0,ENT_QUOTES); ?>%折扣</b><span class="color-red"> x </span><?php endif; ?><b class="color-blue"><?php echo htmlentities((isset($g['stock_sales']) && ($g['stock_sales'] !== '')?$g['stock_sales']:0),ENT_QUOTES); ?>件</b><span class="color-red"> x </span><b class="color-blue"><?php echo htmlentities($g['price_selling']+0,ENT_QUOTES); ?>元 </b><?php echo htmlentities((isset($g['goods_name']) && ($g['goods_name'] !== '')?$g['goods_name']:''),ENT_QUOTES); ?><span class="color-green"> ( <?php echo htmlentities(show_goods_spec($g['goods_spec']),ENT_QUOTES); ?> )</span></div><?php endforeach; ?></td></tr><?php endforeach; ?></tbody></table><?php if(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty())): ?><span class="notdata">没有记录哦</span><?php else: ?><?php echo (isset($pagehtml) && ($pagehtml !== '')?$pagehtml:''); ?><?php endif; ?></div></div></div></div></div>