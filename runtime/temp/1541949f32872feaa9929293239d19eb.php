<?php /*a:3:{s:67:"/www/wwwroot/uexwash.com/ThinkAdmin/app/store/view/order/index.html";i:1682155674;s:77:"/www/wwwroot/uexwash.com/ThinkAdmin/app/store/view/../../admin/view/main.html";i:1670552399;s:74:"/www/wwwroot/uexwash.com/ThinkAdmin/app/store/view/order/index_search.html";i:1681366321;}*/ ?>
<div class="layui-card"><?php if(!(empty($title) || (($title instanceof \think\Collection || $title instanceof \think\Paginator ) && $title->isEmpty()))): ?><div class="layui-card-header"><span class="layui-icon font-s10 color-desc margin-right-5">&#xe65b;</span><?php echo htmlentities((isset($title) && ($title !== '')?$title:''),ENT_QUOTES); ?><div class="pull-right"><!--<?php if(auth("clean")): ?>--><button class='layui-btn layui-btn-sm layui-btn-primary' data-queue='<?php echo url("clean"); ?>'>定时清理订单</button><!--<?php endif; ?>--></div></div><?php endif; ?><div class="layui-card-line"></div><div class="layui-card-body"><div class="layui-card-html"><div class="layui-tab layui-tab-card"><ul class="layui-tab-title notselect"><?php $types = ['ta' => '全部订单', 't1' => '待取货', 't2' => '入库中', 't3' => '清洗中', 't4' => '送货中', 't5' => '已完成','t6' =>'退款']; foreach($types as $k=>$v): if(isset($status) and 't'.$status == $k): ?><li class="layui-this" data-open="<?php echo url('index'); ?>?status=<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?><sup class="layui-badge border-radius"><?php echo isset($total[$k]) ? htmlentities($total[$k],ENT_QUOTES) : 0; ?></sup></li><?php else: ?><li data-open="<?php echo url('index'); ?>?status=<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?><sup class="layui-badge border-radius"><?php echo isset($total[$k]) ? htmlentities($total[$k],ENT_QUOTES) : 0; ?></sup></li><?php endif; ?><?php endforeach; ?></ul><div class="layui-tab-content"><form action="<?php echo sysuri(); ?>" autocomplete="off" class="layui-form layui-form-pane form-search" method="get" onsubmit="return false"><div class="layui-form-item layui-inline"><label class="layui-form-label">订单用户</label><label class="layui-input-inline"><input class="layui-input" name="user_keys" placeholder="请输入手机或昵称" value="<?php echo htmlentities((isset($get['user_keys']) && ($get['user_keys'] !== '')?$get['user_keys']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">订单单号</label><label class="layui-input-inline"><input class="layui-input" name="order_no" placeholder="请输入订单单号" value="<?php echo htmlentities((isset($get['order_no']) && ($get['order_no'] !== '')?$get['order_no']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">发货单号</label><label class="layui-input-inline"><input class="layui-input" name="truck_send_number" placeholder="请输入发货单号" value="<?php echo htmlentities((isset($get['truck_send_number']) && ($get['truck_send_number'] !== '')?$get['truck_send_number']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">订单状态</label><label class="layui-input-inline"><select class="layui-select" name="status"><option value=''>- 全部订单 -</option><?php foreach(['0'=>'待支付','1'=>'待取货','2'=>'入库中','3'=>'清洗中','4'=>'送货中','5'=>'已完成','6'=>'退款'] as $k=>$v): if(input('status') == 't'.$k || input('status') == $k): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">付款状态</label><label class="layui-input-inline"><select class="layui-select" name="pay_status"><option value=''>-- 全部 --</option><?php foreach(['0'=>'等待支付','1'=>'已经支付'] as $k=>$v): if(input('pay_status') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">支付方式</label><label class="layui-input-inline"><select class="layui-select" name="pay_type"><option value=''>-- 全部 --</option><?php foreach($payments as $k=>$v): if(input('pay_type') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v['name'],ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v['name'],ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">下单时间</label><label class="layui-input-inline"><input class="layui-input" data-date-range name="create_at" placeholder="请选择下单时间" value="<?php echo htmlentities((isset($get['create_at']) && ($get['create_at'] !== '')?$get['create_at']:''),ENT_QUOTES); ?>"></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">支付时间</label><label class="layui-input-inline"><input class="layui-input" data-date-range name="payment_at" placeholder="请选择支付时间" value="<?php echo htmlentities((isset($get['payment_at']) && ($get['payment_at'] !== '')?$get['payment_at']:''),ENT_QUOTES); ?>"></label></div><?php if(!isset($store_id)): ?><div class="layui-form-item layui-inline"><label class="layui-form-label">合作店</label><label class="layui-input-inline"><select class="layui-select" name="store_id"><option value=''>-- 全部 --</option><?php foreach($stores as $k=>$v): if(input('store_id') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v['name'],ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v['name'],ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><?php else: ?><input type="hidden" name="store_id" value="<?php echo htmlentities($store_id,ENT_QUOTES); ?>"/><?php endif; ?><div class="layui-form-item layui-inline"><label class="layui-form-label">洗前取件方式</label><label class="layui-input-inline"><select class="layui-select" name="take_type"><option value=''>-- 全部 --</option><?php foreach([1 => '自带',2 => '上门'] as $k=>$v): if(input('take_type') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><div class="layui-form-item layui-inline"><label class="layui-form-label">洗后归还方式</label><label class="layui-input-inline"><select class="layui-select" name="return_type"><option value=''>-- 全部 --</option><?php foreach([1 => '自提',2 => '配送'] as $k=>$v): if(input('return_type') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><?php if(input('status') == 't6' || input('status') == '6'): ?><div class="layui-form-item layui-inline"><label class="layui-form-label">退款方式</label><label class="layui-input-inline"><select class="layui-select" name="refund_status"><option value=''>-- 全部 --</option><?php foreach([1 => '申请',2 => '同意',3 => '拒绝'] as $k=>$v): if(input('refund_status') == $k.''): ?><option selected value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php else: ?><option value="<?php echo htmlentities($k,ENT_QUOTES); ?>"><?php echo htmlentities($v,ENT_QUOTES); ?></option><?php endif; ?><?php endforeach; ?></select></label></div><?php endif; ?><div class="layui-form-item layui-inline"><button class="layui-btn layui-btn-primary" type="submit"><i class="layui-icon">&#xe615;</i> 搜 索</button><button class="layui-btn layui-btn-primary" data-form-export="<?php echo url('index'); ?>?type=<?php echo htmlentities((isset($type) && ($type !== '')?$type:''),ENT_QUOTES); ?>" type="button"><i class="layui-icon layui-icon-export"></i> 导 出
        </button></div></form><script>
    require(['excel'], function (excel) {
        excel.bind(function (data) {
            var items = [];
            items.push(['订单号', '用户手机', '用户姓名', '订单类型', '支付单号', '支付方式', '支付状态', '支付金额', '支付时间']);
            data.forEach(function (order) {
                items.push([
                    order.order_no,
                    order.user.phone,
                    order.user.username || order.user.nickname || '',
                    order.truck_type ? '虚拟商品' : '实物商品',
                    order.payment_trade || '',
                    order.payment_name || order.payment_type || '',
                    order.payment_status ? '已支付' : '未支付',
                    order.payment_amount || '0.00',
                    order.payment_datetime || '',
                ]);
            });
            return items;
        }, '用户订单记录');
    });
</script><table class="layui-table margin-top-10" lay-skin="line"><?php if(!(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty()))): ?><thead><tr><th class='list-table-check-td think-checkbox'><label><input data-auto-none data-check-target='.list-check-box' type='checkbox'></label></th><th>用户信息</th><th>订单信息</th><th>联系信息</th><th>项目信息</th><th>操作</th></tr></thead><?php endif; ?><tbody><?php foreach($list as $key=>$vo): ?><tr><td class='list-table-check-td think-checkbox'><label><input class="list-check-box" type='checkbox' value='<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'></label></td><td class="nowrap relative"><div><div class="headimg" data-lazy-src="<?php echo htmlentities((isset($vo['user']['headimg']) && ($vo['user']['headimg'] !== '')?$vo['user']['headimg']:'/static/theme/img/headimg.png'),ENT_QUOTES); ?>" data-tips-image></div><div class="inline-block sub-strong-red">
                            用户昵称：<span class="color-text"><?php echo htmlentities((isset($vo['user']['nickname']) && ($vo['user']['nickname'] !== '')?$vo['user']['nickname']:'--'),ENT_QUOTES); ?></span><!--span class="margin-left-5">[ <b>VIP<?php echo htmlentities((isset($vo['user']['vip_code']) && ($vo['user']['vip_code'] !== '')?$vo['user']['vip_code']:''),ENT_QUOTES); ?></b> ] <b><?php echo htmlentities((isset($vo['user']['vip_name']) && ($vo['user']['vip_name'] !== '')?$vo['user']['vip_name']:''),ENT_QUOTES); ?></b></span--><br></div></div></td><td class='nowrap'><?php if($vo['status'] == '0'): ?><span class="layui-badge layui-badge-middle layui-bg-orange" >待支付</span><?php endif; if($vo['status'] == '1'): ?><span class="layui-badge layui-badge-middle layui-bg-cyan">待取货</span><?php endif; if($vo['status'] == '2'): ?><span class="layui-badge layui-badge-middle layui-bg-green">入库中</span><?php endif; if($vo['status'] == '3'): ?><span class="layui-badge layui-badge-middle layui-bg-blue">清洗中</span><?php endif; if($vo['status'] == '4'): ?><span class="layui-badge layui-badge-middle layui-bg-black">送货中</span><?php endif; if($vo['status'] == '5'): ?><span class="layui-badge layui-badge-middle layui-bg-green">已完成</span><?php endif; ?><div class="inline-block text-middle"><div class="sub-strong-blue">
                            订单单号：<b><?php echo htmlentities((isset($vo['order_no']) && ($vo['order_no'] !== '')?$vo['order_no']:''),ENT_QUOTES); if($vo['refund_status'] == 2): if($vo['refund_request']): ?>                                       (<span class="color-red">退-客户申请</span>) 
                                      <?php else: ?>                                      (<span class="color-red">退-管理员操作</span>) 
                                     <?php endif; ?><?php endif; ?></b><!--<?php if($vo['status'] == '3'): ?>--><a class="margin-left-5 layui-badge layui-bg-blue" data-modal="<?php echo url('audit'); ?>?order_no=<?php echo htmlentities($vo['order_no'],ENT_QUOTES); ?>">凭证审核</a><!--<?php endif; ?>--></div><div class="sub-strong-blue">
                            订单总计：<b><?php echo htmlentities($vo['discount_price']+0,ENT_QUOTES); ?></b> 元
                            <span class="color-green">原价 <?php echo htmlentities($vo['regular_price']+0,ENT_QUOTES); ?> 元, 随减 <?php echo htmlentities($vo['amount_reduct']+0,ENT_QUOTES); ?> 元</span></div><div>下单时间：<span class="color-text"><?php echo htmlentities($vo['create_at'],ENT_QUOTES); ?></span></div><!--<?php if(!(empty($vo['status']) || (($vo['status'] instanceof \think\Collection || $vo['status'] instanceof \think\Paginator ) && $vo['status']->isEmpty()))): ?>--><div>
                        支付时间：<span class="color-text"><?php echo htmlentities(format_datetime($vo['payment_at']),ENT_QUOTES); ?></span><!--<?php endif; ?>--><!--<?php if(!(empty($vo['status']) || (($vo['status'] instanceof \think\Collection || $vo['status'] instanceof \think\Paginator ) && $vo['status']->isEmpty()))): ?>-->
                        支付状态：<span class="color-desc">还未支付</span><!--<?php endif; ?>--></div></td><td class="nowrap"><div class="sub-strong-blue">
                        洗前取件方式:<a data-title="更改方式" data-modal='<?php echo url("editTake"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>&type=send'><b><?php echo htmlentities((isset($vo['take_type_text']) && ($vo['take_type_text'] !== '')?$vo['take_type_text']:''),ENT_QUOTES); ?></b></a></div><?php if($vo['take_type'] == 1 && $vo['take_address'] != false): ?><div><b>地址</b>:<?php echo htmlentities($vo['take_address']['address'],ENT_QUOTES); ?></div><div ><b>联系人</b>: <?php echo htmlentities($vo['take_address']['name'],ENT_QUOTES); ?>&nbsp;&nbsp; <?php echo htmlentities($vo['take_address']['phone'],ENT_QUOTES); ?></div><div ><b>取件日期</b>: <?php echo htmlentities($vo['take_date'],ENT_QUOTES); ?></div><?php endif; ?><div class="sub-strong-blue">
                        洗后取件方式:<a data-title="更改方式" data-modal='<?php echo url("editTake"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>&type=return'><b><?php echo htmlentities((isset($vo['return_type_text']) && ($vo['return_type_text'] !== '')?$vo['return_type_text']:''),ENT_QUOTES); ?></b></a></div><?php if($vo['return_type'] == 2 && $vo['send_address'] != false): ?><div class="sub-strong-blue"><b>地址</b>:<?php echo htmlentities($vo['send_address']['address'],ENT_QUOTES); ?></div><div class="sub-strong-blue"><b>联系人</b>: <?php echo htmlentities($vo['send_address']['name'],ENT_QUOTES); ?>&nbsp;&nbsp; <?php echo htmlentities($vo['send_address']['phone'],ENT_QUOTES); ?></div><div ><b>送回日期</b>: <?php echo htmlentities($vo['return_date'],ENT_QUOTES); ?></div><?php endif; ?></td><td class="nowrap"><div><div>订单项目：
                         <?php foreach($vo['goods_data']['goods'] as $good): ?><div calss="good_box"><b class="color-text"><?php echo htmlentities((isset($good['name']) && ($good['name'] !== '')?$good['name']:''),ENT_QUOTES); ?></b><span class="color-text"> x </span><span class="color-red"><?php echo htmlentities((isset($good['good_num']) && ($good['good_num'] !== '')?$good['good_num']:''),ENT_QUOTES); ?></span>&nbsp;&nbsp;
                                 <b class="color-blue"><?php echo htmlentities($good['price_selling']+0,ENT_QUOTES); ?>元 </b></div><?php endforeach; ?></div></div></td><td class="nowrap"><?php if(auth('inStock') && $vo['order_status'] == 1): ?><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("inStock"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>入库</a><!--a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("back"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>退回</a--><?php endif; if(auth('washing') && $vo['order_status'] == 2): ?><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("track"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>操作记录</a><div style="height:10px;"></div><div><a class="layui-btn layui-btn-sm" data-action='<?php echo url("washing"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>' data-confirm="确定开始进行清洗？">开始清洗</a><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("back"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>退回</a></div><?php endif; if(auth('transport') && $vo['order_status'] == 3): ?><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("track"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>操作记录</a><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("transport"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>配送</a><?php endif; if($vo['order_status'] == 4): ?><p><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("track"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>操作记录</a></p><div class="color-green">衣物运输中，等待客户确认</div><?php endif; if($vo['order_status'] == 5): ?><p><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("track"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>操作记录</a></p><?php endif; if($vo['order_status'] == 6): ?><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("track"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>操作记录</a><?php if($vo['status'] == 2): ?><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("back"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>退回</a><?php endif; ?><div style="height:10px;"></div><?php if($vo['refund_request']): ?><a class="layui-btn layui-btn-sm layui-btn-danger"  data-modal='<?php echo url("refunds"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>退款记录</a><?php endif; if($vo['refund_status'] == 1): ?><div class="color-orange">当前用户申请退款</div><?php endif; if($vo['refund_status'] == 2): if($vo['status'] == 4): ?><div class="color-blue">退款申请已同意,等待客户确认收货</div><?php elseif(in_array($vo['status'],[1,2])): if($vo['status'] == 1): ?><a class="layui-btn layui-btn-sm"  data-modal='<?php echo url("transport"); ?>?order_id=<?php echo htmlentities($vo['id'],ENT_QUOTES); ?>'>退回</a><?php endif; ?><div class="color-green">退款完成</div><?php else: ?><div class="color-green">退款,客户确认收货完成</div><?php endif; ?><?php endif; if($vo['refund_status'] == 3): ?><div class="color-red">退款申请已拒绝</div><?php endif; if($vo['refund_status'] == 5): ?><div class="color-green">退款成功，客户已收到衣物</div><?php endif; ?><?php endif; ?></td></tr><?php endforeach; ?></tbody></table><?php if(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty())): ?><span class="notdata">没有记录哦</span><?php else: ?><?php echo (isset($pagehtml) && ($pagehtml !== '')?$pagehtml:''); ?><?php endif; ?></div></div></div></div></div>